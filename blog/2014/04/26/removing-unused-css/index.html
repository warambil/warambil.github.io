
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Removing Unused CSS - Wilman Arambillete</title>
  <meta name="author" content="Wilman Arambillete">

  
  <meta name="description" content="It seems as if all web developers are lately aiming at reducing the size of the content delivered to the browser. It is in fact a big challenge and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://warambil.com/blog/2014/04/26/removing-unused-css">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Wilman Arambillete" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Muli:300,400,300italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=News+Cycle|Open+Sans:400,300' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-21833652-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Wilman Arambillete</a></h1>
  
    <h2>Software development and eCommerce</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

  <form method="get" action="/search.html">
    <fieldset role="search">
      <input class="search" name="query" type="text" placeholder="Search..." x-webkit-speech />
    </fieldset>
  </form>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Removing Unused CSS</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-26T21:25:26-03:00" pubdate data-updated="true">Apr 26<span>th</span>, 2014</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://warambil.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><img class="left" src="/images/unused-css.png" width="400" title="unused-css" alt="images"></p>

<p>It seems as if all web developers are lately aiming at reducing the size of the content delivered to the browser.</p>

<p>It is in fact a big challenge and optimizing a web site content delivery might imply a great deal of tweaks and tricks to be successfully accomplished.</p>

<p>Apache modules like <a href="http://www.modpagespeed.com">PageSpeed</a> are vital in this mission. PageSpeed improves web page latency by modifying the resources on the page. For example a set of filters are applied to perform tasks such as altering the HTML content, changing CSS and JS files references or simply making pages to point to more optimized images.</p>

<p>Custom optimization strategies are applied to different assets in order to reduce the loading time. These ones involve inlining small resources, dynamically minifying JS and CSS files, and so on and so forth.</p>

<p>These techniques can obviously be of great help but they are only the tip of the iceberg. Since we as developers have been starting using boilerplates with tools like Yeoman, we can build our own set of tools to automatically generate a better content before it is deployed to the web server.</p>

<p>This means that we now have a great deal of <a href="https://www.npmjs.org/">npm</a> packages at our hands, ready to be piped with <a href="http://gulpjs.com/">Gulp.js</a> (<a href="http://warambil.com/blog/2014/04/20/it-is-all-about-streams/">please read my previous post about this</a>).</p>

<p>When I first heard about <em>Uncss</em> techniques I must confess I did not grasp the real potential behind it. At first, I thought it was just about removing unused css from static HTML pages.</p>

<p>I thought that using <a href="https://github.com/ben-eb/gulp-uncss">gulp-uncss</a> on static HTML files made no sense at all, specially considering that most of nowadays web sites are either server script generated pages or JavaScript SPAs (Single Page Applications).</p>

<p>It was not until I found Giacomo Martino&rsquo;s project (<a href="https://github.com/giakki/uncss">Uncss</a>), that I could understand how awesome it is.</p>

<p>In order to fully understand how it all works, we must first learn about other apps.</p>

<h2><a href="http://phantomjs.org">PhantomJs</a></h2>

<p>PhantomJs is <em>headless Webkit scriptable with a Javascript API</em>.
In other words, it is a full stack webkit where you can render any website as if it were rendered by a regular browser.</p>

<p>For instance, you might need to use it for</p>

<ul>
<li>Headless website testing</li>
<li>Screen capturing</li>
<li>Page automation</li>
<li>Network monitoring</li>
</ul>


<p>Let&rsquo;s see a couple of examples taken from <a href="http://phantomjs.org/quick-start.html">their website</a>, to understand how it works.</p>

<h3>Capture a web page</h3>

<p>Create a very basic Javascript file named <em>Capture.js</em></p>

<pre><code>var page = require('webpage').create();
page.open('http://example.com', function() {
  page.render('example.png');
  phantom.exit();
});        
</code></pre>

<p>Then, all we do is this</p>

<pre><code>phantomjs Capture.js
</code></pre>

<p>That&rsquo;s it. This script opens the indicated URL and renders the whole content into an example.png file.</p>

<h3>Page loading time measurement</h3>

<p>Create a javascript file called <em>LoadSpeed.js</em></p>

<pre><code>var page = require('webpage').create(),
  system = require('system'),
  t, address;
if (system.args.length === 1) {
  console.log('Usage: loadspeed.js &lt;some URL&gt;');
  phantom.exit();
}
t = Date.now();
address = system.args[1];
page.open(address, function(status) {
  if (status !== 'success') {
    console.log('FAIL to load the address');
  } else {
    t = Date.now() - t;
    console.log('Loading time ' + t + ' msec');
  }
  phantom.exit();
});
</code></pre>

<p>Then, we must execute as follows</p>

<pre><code>phantomjs loadspeed.js http://www.google.com
</code></pre>

<p>and we should obtain an output like this</p>

<p><em>Loading <a href="http://www.google.com">http://www.google.com</a> Loading time 719 msec</em></p>

<h2>So how does <a href="https://github.com/giakki/uncss">Uncss</a> work then?</h2>

<p>Basically, <em>UnCSS</em> removes unused CSS from your stylesheets by performing the following tasks:</p>

<ol>
<li>PhantomJs loads HTML files and Javascript is executed</li>
<li>It checks what styles are actually being used in every page</li>
<li>A parser (css-parse) is applied to the concatenated bunch of css files</li>
<li>All unused selectors are ruled out and an optimized resulting CSS file is created.</li>
</ol>


<p>UnCss is a node.js project and you could <a href="https://github.com/giakki/uncss">check its repository</a> if you would like to dive in and use it right away.</p>

<p>However, we would like to go one step further.</p>

<h2>gulp-uncss</h2>

<p>This GulpJs task uses UnCss to parse a set of <em>HTML</em> files and an original <em>CSS</em> file in order to remove unused styles.</p>

<p>As any other gulp npm package this one is installed as follows</p>

<pre><code>npm install gulp-uncss --save-dev
</code></pre>

<p>Now, as usual we can pipe this task with the rest of our pre deployment tasks. I ran the following example against my Octopress blog.</p>

<pre><code>var gulp = require('gulp');
var uncss = require('gulp-uncss');
var minifyCSS = require('gulp-minify-css');
gulp.task('default', function() {
    return gulp.src('/octopress/public/stylesheets/screen.css')
        .pipe(uncss({
            html: ['/octopress/public/index.html']
        }))
        .pipe(minifyCSS())
        .pipe(gulp.dest('./out'));
});
</code></pre>

<p>As you can see, I also added a <em>minify</em> task to the process so you could see that this task can be piped to any other GulpJs task.</p>

<p>The overall process was very fast in this case and the original CSS file size was reduced from 38Kb to 12K.</p>

<h2>Further considerations</h2>

<p>The task execution time can be drastically incremented if files are obtained directly from an external site, so it is recommended to run this task together with the rest of the optimization tasks you usually run with GulpJs on your <em>/dist</em> directory, before your actual deployment.</p>

<p>If you need to run it against external generated HTML files, you should better previously save those files using PhantomJs and run the task locally (adding the local CSS file).</p>

<h2>Final thoughts</h2>

<p>After digging into all these techniques, I feel more and more confident that GulpJs and node streams are the way to go as part of the development process.</p>

<p><a href="http://yeoman.io/">Yeoman</a> has proven to be a core foundation for our web projects and <a href="http://gulpjs.com/">Gulp.js</a> is a <em>must</em> for batch tasks.</p>

<p>More GulpJs apps are being created everyday and we can easily add them to our GulpFile.js file in order to get a truly optimized bundle before deployment.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Wilman Arambillete</span></span>

      








  


<time datetime="2014-04-26T21:25:26-03:00" pubdate data-updated="true">Apr 26<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/css/'>Css</a>, <a class='category' href='/blog/categories/node-dot-js/'>Node.js</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://warambil.com/blog/2014/04/26/removing-unused-css/" data-via="warambil" data-counturl="http://warambil.com/blog/2014/04/26/removing-unused-css/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/04/20/it-is-all-about-streams/" title="Previous Post: It is all about streams">&laquo; It is all about streams</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/26/removing-unused-css/">Removing Unused CSS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/20/it-is-all-about-streams/">It Is All About Streams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/19/moving-from-wordpress-to-octopress/">Moving From Wordpress to Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/18/aws-how-to-setup-a-basic-lamp-server/">How to Setup a Basic LAMP Server on an EC2 Micro Instance</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/aws/'>AWS (1)</a></li><li><a href='/blog/categories/css/'>Css (1)</a></li><li><a href='/blog/categories/gulp-dot-js/'>Gulp.js (1)</a></li><li><a href='/blog/categories/node-dot-js/'>Node.js (2)</a></li><li><a href='/blog/categories/opinion/'>Opinion (1)</a></li></ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Wilman Arambillete -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'warambil';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://warambil.com/blog/2014/04/26/removing-unused-css/';
        var disqus_url = 'http://warambil.com/blog/2014/04/26/removing-unused-css/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
